---
title: "LUBDES RMA Analysis - Imputation Methods"
author: "Katharina Gerstner"
date: "`r Sys.Date()`"
output:
  word_document:
    fig_width: 5
    fig_height: 5
    fig_caption: true
---

```{r opts, include=F}
knitr::opts_chunk$set(
  fig.path = "C:/Users/hoppek/Documents/temp/"
)
path2temp <- "C:/Users/hoppek/Documents/temp/"
library(knitr)
"%+%" <- function(x,y)paste(x,y,sep="")
```

# AIMS  
Synthesize available data to obtain a global perspective on how changes in land use intensity affect both biodiversity (focusing on species richness, because this is what most studies record) and production (measured as biomass per unit area per year, or the nearest available proxy, and their trade-off). 

# DATA STRUCTURE  
To answer our research questions we have coded covariables and summary statistics from various studies leading to a nested structure of cases within the same study. Cases within a single study have been observed different land-use intensity range level in the same location for a single species group or product. Hence cases within a single study are distinguished by location-related covariables, species groups or product. Below we visualized the general data structure. 
```{r, echo=F}
df <- data.frame(study=c("A","A","A","A","A","B","B"),case=c(1,1,1,2,2,1,1),LUI.range=c("low-low","low-medium","low-high","low-medium","low-high","low-medium","low-high"), species.group=c(rep("plants",3),rep("mammals",2), rep("plants",2)), Log.RR=rnorm(7),Log.RR.Var=abs(rnorm(7,mean=0,sd=0.5)))
df
```

**Richness**  
Number of studies = 110  
Number of raw data points = 527  
Number of missing SD in raw data = 132 (i.e. 25\% missing SDs)  
Number of effect sizes after combining raw data points without imputation = 188  
Number of effect sizes after combining raw data points with imputation = 290    

**Yield**  
Number of studies = 117  
Number of raw data points = 369  
Number of missing SD in raw data = 81 (i.e. 22\% missing SDs)  
Number of effect sizes after combining raw data points without imputation = 100   
Number of effect sizes after combining raw data points with imputation = 157   

# Problem Statement
Missing data are a serious problem for any synthetic eﬀorts and can compromise the integrity of meta-analyses. It has been shown that incomplete-case removal can lead to biased and imprecise coefficient estimates and yield poorly specified models. Therefore, it has been suggested that incomplete-case removal should not be used in meta-regression and that multiple imputation has the potential to be an indispensable tool for meta-regression in ecology and evolution (Ellington et al. 2015).

The standard deviation (SD) of effect sizes in meta-analyses is used to weight the studies. The lower the SD, the more precise are the results, the higher the weight it gets in the analysis. We will explore three options to handle missing data on SDs:  
1. Incomplete-case removal,   
2. Use mean of imputations, i.e. calculate the mean across the imputation chains and perform a single analysis.  
3. Multiple imputation, i.e. loop through 10 imputation chains, repeat the analysis, average resulting model parameters according to Nakagawa & Freckleton (2011) 

# METHODS  
## IMPUTATION
We imputed missing data on SDs using the function mice in the R-package mice (version 2.22). Therefore, we used predictive mean matching (which is based on Rubin, D.B. (1987). Multiple imputation for nonresponse in surveys. New York: 'Wiley.). It fits the relationship between means of RRs, standard deviation and number of samples to the complete data. It then generates multiple imputations by Gibbs sampling, i.e. makes a random draw from the “posterior predictive distribution” of model coefficients. 

### Variation of Imputation
![](C:\Users\hoppek\Documents\temp\imputed.SD.richness.png)       
![](C:\Users\hoppek\Documents\temp\imputed.SD.yield.png)

Figures show the distribution of imputed SDs. On the x-axis are the Study-Case IDs with missing SDs. Red dots are the imputed SDs from the 10 chains. Black dots represent the mean of the red dots.

## META-ANALYSIS
We then fit linear mixed effects model using rma.mv::metafor (version 1.9-8) and accounted for (1) non-independence of observations from related sources, i.e. the same study-case and study, by specifying random=list(~1|study.case,~1|study), and (2) non-independence from relatedness of LUI comparisons when multiple comparisons within one study-case are used by specifying covariances as $cov(X,Y) = cor(X,Y)*sqrt(Var(X))*sqrt(Var(Y))$ where $cor(X,Y)$ set to 0.5 if X,Y belong to the same study-case and share a control or treatment, because the effect size $X$ determines 50$\%$ of the effect size $Y$ and vice versa.

We analyzed models of  
1. Grand mean  
2. LUI ranges  
3. LUI ranges and interactions with species group (only for species richness), product, biome and performed variable selection using the AIC.  

## RESULTS

### Comparison of parameter estimates
Forest Plots of parameter estimates for models of the Grand Mean (top) and LUI ranges (bottom) for species richness and yield. Note that forest plots for LUI ranges and interactions with species group (only for species richness), product, and biomes are not shown.

![](C:\Users\hoppek\Documents\temp\Complete_vs_MeanImp_vs_MulitpleImp_None_Richness.png)  
![](C:\Users\hoppek\Documents\temp\Complete_vs_MeanImp_vs_MulitpleImp_LUI_Richness.png)  

![](C:\Users\hoppek\Documents\temp\Complete_vs_MeanImp_vs_MulitpleImp_None_Yield.png)  
![](C:\Users\hoppek\Documents\temp\Complete_vs_MeanImp_vs_MulitpleImp_LUI_Yield.png)  

### Comparison of fit statistics
We evaluated the goodness-of-fit using various statistics provided by the metafor-package:  

- restricted log-likelihood,  
- deviance,  
- AIC,  
- BIC,  
- AICc,  

Note that variance components in the model (e.g., $\tau^2$ in random/mixed-effects models) are counted as additional parameters in the calculation of the AIC, BIC, and AICc. Also, the fixed effects are counted as parameters in the calculation of the AIC, BIC, and AICc even when using REML estimation. However, for mixed-effects models the number of parameters is not so clearly defined but depend on the amount of pooling (Gelman & Hill 2006, p. 525f). Hence, statistics might be misleading.

- $R^2_{LMM(m)}$, i.e. the percentage of variance explained by the fixed effects,
- $R^2_{LMM(c)}$, i.e. the percentage of variance explained by the fixed and random effects (cf. Nakagawa & Schielzeth 2012).  

Relative, the models show the same patterns: Lower AIC of LUI model compared to the grand mean model, lowest AIC for the full model, which is the same as the selected, i.e. all covariables significantly contribute to the explanatory power.  

**BASED ON INCOMPLETE-CASE REMOVAL**
```{r}
# Fit statistics for species richness
kable(read.csv(path2temp %+% "CompleteCases/" %+% "fit.tab.richness.csv"), digits=2)

# Fit statistics for yield
kable(read.csv(path2temp %+% "CompleteCases/" %+% "fit.tab.yield.csv"), digits=2)
```

**BASED ON MEAN OF IMPUTATION**
```{r}
# Fit statistics for species richness
kable(read.csv(path2temp %+% "fit.tab.richness.csv"), digits=2)

# Fit statistics for yield
kable(read.csv(path2temp %+% "fit.tab.yield.csv"), digits=2)
```

**MULTIPLE IMPUTATION (mean of fit statistics)**
```{r}
# Fit statistics for species richness
kable(read.csv(path2temp %+% "ModelsAvgImp_fit.tab.richness.csv"), digits=2)

# Fit statistics for yield
kable(read.csv(path2temp %+% "ModelsAvgImp_fit.tab.yield.csv"), digits=2)
```

## SUMMARY  
- Multiple imputation results in a drastic increase of uncertainty in the parameter estimates. This is due to the large variation of imputed SDs. Looking at the distribution of imputed SDs, we note that many imputed SDs are smaller than the mean. Hence, using the mean instead might account for the lower confidence we have for imputed SDs.  
- In most cases we obtain comparable parameter estimates using incomplete-case removal and mean imputation. In only 2 cases, significance or direction changes. The effect of imputation is most severe in groups with a large ratio of imputed SDs/observed SDs. Hence, the finer our grouping the more sensitive are our results with respect to imputation.  
- The sensitivity of results against imputation has also implications on reporting of results. While it makes sense to compare the explanatory power of models using different sets of covariables it makes no sense to interpret parameter estimates for models using more covariables than the LUI ranges.



