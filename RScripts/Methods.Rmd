---
title: "LUBDES Bayesian Data Analysis - Methods"
author: "Katharina Gerstner"
date: "Thursday, April 21, 2016"
output: html_document
---

# AIMS  
Synthesize available data to obtain a global perspective on how changes in land use intensity affect both biodiversity (focusing on species richness, because this is what most studies record) and production (measured as biomass per unit area per year, or the nearest available proxy, and their trade-off). 

# METHODS  
## IMPUTATION
We imputed missing data on standard deviations using the bayesian approach of Stevens (2011). This model estimated a population standard deviation $\sigma$. The square of missing sample standard deviations were drawn from a gamma distribution with parametes $\alpha=\frac{n-1}{2}$ and $\beta=\frac{n-1}{2\cdot\overline{\sigma}^2}$.

Goodness-of-fit of the imputation model: Observed vs predicted standard deviation.
![](C:\Users\hoppek\Documents\temp\MissingDataImputation_Richness.png)
![](C:\Users\hoppek\Documents\temp\MissingDataImputation_Yield.png)

## META-ANALYSIS
We used a bayesian model approach as it is much better at dealing with multiple sources of uncertainty and can deal with multi-level models. 
We fitted bayesian mixed-effects models and account for (1) non-independence of observations from related sources, i.e. the same study-case, and (2) non-independence from relatedness of LUI comparisons when multiple comparisons within one study-case are used.

# DATA STRUCTURE  
```{r}
df <- data.frame(study=c("A","A","A","A","A","B","B"),case=c(1,1,1,2,2,1,1),LUI.range=c("low-low","low-medium","low-high","low-medium","low-high","low-medium","low-high"), species.group=c(rep("plants",3),rep("mammals",2), rep("plants",2)), Log.RR=rnorm(7),Log.RR.Var=abs(rnorm(7,mean=0,sd=0.5)))
df
```

# MODEL  
```{r, eval=F}
Log.RR[i] ~ N(mu[i], Log.RR.var[i]+error[i])
mu[i] = X[i,] %*% beta
error[i] = a[i] + v[Study.Case[i]] + w[i]
```

where $a$, $v$ and $w$ are normally distributed around zero with variance $\sigma_a^2 \cdot A$, $\sigma_v^2 \cdot I$ and $\sigma_w^2 \cdot I$. The matrix $A$ represents the covariance matrix between related study-cases with zeroes on the diagonal. We set the hierarchical covariance to $A_{i,j}=0.5 \cdot \sigma_i \cdot \sigma_j$ if $i, j$ belong to the same study-case and share a control or treatment, because the effect size $i$ determines 50% of the effect size $j$ and vice versa. Priors for the $\sigma$'s have been chosen from a uniform distribution with limits 0 and 100.

For the analysis we used the R-package rjags For each run we used 3 MCMC chains, Nadapt=1000; Nstart=2000; Niter=50000; Nthin=5


We analyzed models of  
1. Grand mean  
2. LUI ranges  
3. LUI ranges and interactions with species group, product, biome and performed variable selection using the deviance information criterion DIC which is comparable with AIC but suitable for hierarchical models where the number of parameters is not so clearly defined (Gelman & Hill 2006, p. 525f).

# MODEL DIAGNOSTICS
- Convergence: We visually checked for convergence of Markov Chains using trace plots. 
- Posterior predictive check using bayesian p-value
- Residuals vs. predictions

# GOODNESS-OF-FIT  
We calculated various statistics to compare models among each other:
- $DIC$, i.e. the deviance information criterion which is comparable with AIC but suitable for hierarchical models where the number of parameters is not so clearly defined (Gelman & Hill 2006, p. 525f)
- $R^2_{LMM(m)}$, i.e. the marginal $R^2$ and represents the amount of explained variance by the fixed effects only (Nakagawa & Schielzeth 2012)
- $R^2_{LMM(c)}$, i.e. the conditional $R^2$ and represents the amount of explained variance by the fixed and random effects (Nakagawa & Schielzeth 2012)
- $R^2_{GH}$, i.e. the averaged amount of explained varianced for each level (Gelman & Hill 2007, p. 474)

# PUBLICATION BIAS
TO DO!



